[{"id":"65e9757c31af6de0","type":"tab","label":"BIL54 api.statbank.dk","disabled":false,"info":"","env":[]},{"id":"45c748a9bb3d89b9","type":"tab","label":"AREALDK api.statbank.dk","disabled":false,"info":"# Danmarks areal\n### Statistikken viser Danmarks areal fordelt efter kommuner og regioner, opgjort pr. 1. januar. \nFra 2011 er opgørelsen baseret på data fra Geodatastyrelsens matrikelregister.\nKun matrikulerede områder er medtaget ved opmålingen, hvilket medfører, at mange søer ikke er medtaget. '\nFor kommuner med umatrikulerede søer vil arealet derfor være faldet sammenlignet med tidligere. Pr. 1. januar 2011-2013 gælder yderligere for København og Frederiksberg, at vejene ikke er matrikuleret og derfor ikke indgår i det opmålte areal.\n\nhttps://www.dst.dk/da/Statistik/dokumentation/statistikdokumentation/arealregnskab/indhold","env":[]},{"id":"c57523bd9147a472","type":"tab","label":"FORBRUG energidataservice.dk","disabled":false,"info":"# FORBRUG\n\n[Energidataservice](https://www.energidataservice.dk/tso-electricity/ConsumptionpermunicipalityDE35)","env":[]},{"id":"8834f4e823c6a1a3","type":"tab","label":"LAVBUND opendata.dk","disabled":true,"info":"# Våd- og lavbundsområder i Randers kommune siden år 2000\r\n### Etablerede våd- og lavbundsområder i Randers kommune fra år 2000 og frem\r\n\r\nhttps://www.opendata.dk/randers-kommune/vad-og-lavbundsomrader-i-randers-kommune-siden-ar-2000","env":[]},{"id":"dbcc6c9bc30cc8ba","type":"tab","label":"Database connector","disabled":false,"info":"","env":[]},{"id":"6e7a468eaacb3121","type":"group","z":"8834f4e823c6a1a3","name":"Forespørgsel til admin.opendata.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["76456d745e183b34","d4cc21141f5b8593","447f39147089ad83","42362e792c0ccae4"],"x":94,"y":175,"w":972,"h":138},{"id":"9072a48aa3a295a8","type":"group","z":"8834f4e823c6a1a3","name":"Database opsætning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["5faf844e177663ee","3bb87be8a8c0c420","65752c31a5522faf","d1f909b168e33c40","c9fe3d3be6783787"],"x":94,"y":475,"w":992,"h":130},{"id":"135076410a4b1b18","type":"group","z":"8834f4e823c6a1a3","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["5362319b65082b0a","57182fe99ae6760e","47bb8108ee8bcb77"],"x":94,"y":655,"w":632,"h":130},{"id":"f21554e84cd0d748","type":"group","z":"8834f4e823c6a1a3","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["d23c2161e5f2c8ca","a6867a7bb823f3bf","5346920c94e7372c","122e767f6beb5d9c"],"x":94,"y":336,"w":972,"h":106},{"id":"9a408a2759ec3084","type":"group","z":"dbcc6c9bc30cc8ba","name":"Database connector","style":{"stroke":"none","stroke-opacity":"0.5","fill":"#bfc7d7","fill-opacity":"0.51","label":true,"color":"#3f3f3f"},"nodes":["3f847e4f2e488027","52e079e6119e62ca","a3742ded5fba6dee","639eedc003d9447d","3dc733d677d6b321","acfdb72c96a033c1"],"x":74,"y":39,"w":652,"h":122},{"id":"7594e465324c4a7d","type":"group","z":"c57523bd9147a472","name":"Initialisering af tabelnavn og database","style":{"stroke":"none","fill":"#bfdbef","label":true,"color":"#7f7f7f","fill-opacity":"0.5"},"nodes":["b32b085c2d36490a","71c08e72255922c6","f6838a16d2e608d9","422fe331a1d9712d"],"x":114,"y":35,"w":1092,"h":130},{"id":"46586d3536cd47cc","type":"group","z":"c57523bd9147a472","name":"Udregn startdato for datatræk","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.39"},"nodes":["9112c74df78eeb8d","c8aa0d3e029ac7a2","8d5e4351d2cf66d3","b92b3a2d80cc8ee8","e0990e8cad6c838f"],"x":114,"y":259,"w":1152,"h":166},{"id":"71f4232f84760c95","type":"group","z":"c57523bd9147a472","name":"Forespørgsel til api.energidataservice.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["1117106bda48e1ac","f76c6798af9cfd95","ddaaed79ead52943","27623012081e2a39"],"x":114,"y":434,"w":832,"h":119},{"id":"808dce21ee927308","type":"group","z":"c57523bd9147a472","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["9ea86f7e0ce10f99","99165a843037b931","9b7898c7088f9a4e"],"x":114,"y":567,"w":452,"h":106},{"id":"5ec9e9daf7becd6b","type":"group","z":"c57523bd9147a472","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["a10bfbed8613f040","63f448e05f661eac","8da50384ff05535a","bab3bc667b86d0dc","692724b4ed7ce476"],"x":114,"y":695,"w":632,"h":130},{"id":"74accbadad317ac9","type":"group","z":"45c748a9bb3d89b9","name":"Initialisering af tabelnavn og database","style":{"stroke":"none","fill":"#bfdbef","label":true,"color":"#7f7f7f","fill-opacity":"0.5"},"nodes":["6f0df73838f8a16d","24aea33ae1a059ff","a0e1ed04ee543327","8aa2da41c389bf11"],"x":114,"y":35,"w":1092,"h":130},{"id":"e305aa6360bd66a1","type":"group","z":"45c748a9bb3d89b9","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["2c12abb429fa27f5","36e6150307870585","5bc0075c1c938d7e","5d9c0209ba869676","e468dbc04e7bb1d3"],"x":114,"y":575,"w":642,"h":130},{"id":"dffd493b5177004f","type":"group","z":"45c748a9bb3d89b9","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["8816f3d97fb78d19","e67cc7cbad9479e6","7a1c64b88d033906","586901d2bc7ea4e9"],"x":114,"y":414,"w":932,"h":119},{"id":"7a1be7166080e405","type":"group","z":"65e9757c31af6de0","name":"Initialisering af tabelnavn og database","style":{"stroke":"none","fill":"#bfdbef","label":true,"color":"#7f7f7f","fill-opacity":"0.5"},"nodes":["aec576b7c50a7dbb","6d0ea4abbb2329f2","38ca1cb7260a67fd","b1303341834b49b1"],"x":114,"y":35,"w":1092,"h":130},{"id":"3a97118afcc37812","type":"group","z":"65e9757c31af6de0","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["41fdc630ccb292a8","be809a1b31c5ea46","8e4c5974c76b9636","3083d0816f66aea2","a4e66bba0b79093f"],"x":114,"y":575,"w":652,"h":130},{"id":"b4f3fef5b6796d67","type":"group","z":"65e9757c31af6de0","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["cfe095ad4945e166","eb9e4a0ec396482a","4177dc7cb8ca7afc","b2aa1b69129eac7a"],"x":114,"y":414,"w":832,"h":119},{"id":"195346dcdad54c42","type":"group","z":"45c748a9bb3d89b9","name":"Forespørgsel til api.statbank.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["c85839311d89a6fc","627a6e96dd5e1fd6","21474c826264a627","294694f536a9344a"],"x":114,"y":254,"w":952,"h":131},{"id":"8a2c08c2207f332c","type":"group","z":"65e9757c31af6de0","name":"Forespørgsel til api.statbank.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["1f733c3ff9a7a37b","a89615316da24ea8","0a0ae1025f784e27","ec44014918f4a6be"],"x":114,"y":254,"w":952,"h":131},{"id":"5980dd1bcc61a463","type":"junction","z":"8834f4e823c6a1a3","x":360,"y":120,"wires":[["db31d2bd175ea824"]]},{"id":"db31d2bd175ea824","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":180,"wires":[["76456d745e183b34"]]},{"id":"e882301a1d27066d","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":340,"wires":[["5346920c94e7372c"]]},{"id":"0710567a0b7e455c","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":480,"wires":[["d1f909b168e33c40"]]},{"id":"1f2d319f4929ac71","type":"junction","z":"8834f4e823c6a1a3","x":1100,"y":280,"wires":[["e882301a1d27066d"]]},{"id":"6dd4f5c2593f3946","type":"junction","z":"8834f4e823c6a1a3","x":1120,"y":440,"wires":[["0710567a0b7e455c"]]},{"id":"b17360901cb08980","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":660,"wires":[["47bb8108ee8bcb77"]]},{"id":"69d887b38b99f13c","type":"junction","z":"8834f4e823c6a1a3","x":1080,"y":600,"wires":[["b17360901cb08980"]]},{"id":"9c636ef772b22d40","type":"junction","z":"c57523bd9147a472","x":100,"y":580,"wires":[["99165a843037b931"]]},{"id":"bd6e826c1aa15fa0","type":"junction","z":"c57523bd9147a472","x":80,"y":700,"wires":[["63f448e05f661eac"]]},{"id":"ffcaf5a90d067842","type":"junction","z":"c57523bd9147a472","x":600,"y":660,"wires":[["bd6e826c1aa15fa0"]]},{"id":"96e0aebc629488f6","type":"junction","z":"c57523bd9147a472","x":960,"y":540,"wires":[["9c636ef772b22d40"]]},{"id":"2b035082d5a6ff72","type":"junction","z":"c57523bd9147a472","x":80,"y":280,"wires":[["9112c74df78eeb8d"]]},{"id":"27623012081e2a39","type":"junction","z":"c57523bd9147a472","g":"71f4232f84760c95","x":680,"y":460,"wires":[["3926f857306514b0"]]},{"id":"e46f8006b6de0ec5","type":"junction","z":"c57523bd9147a472","x":1320,"y":400,"wires":[["367e58cdba9fe7fd"]]},{"id":"367e58cdba9fe7fd","type":"junction","z":"c57523bd9147a472","x":80,"y":440,"wires":[["1117106bda48e1ac"]]},{"id":"8c654e6585d20b9e","type":"junction","z":"45c748a9bb3d89b9","x":100,"y":580,"wires":[["e468dbc04e7bb1d3"]]},{"id":"51c2c7e50c627a62","type":"junction","z":"45c748a9bb3d89b9","x":80,"y":280,"wires":[["c85839311d89a6fc"]]},{"id":"4cf9747f6aeb4e16","type":"junction","z":"45c748a9bb3d89b9","x":60,"y":420,"wires":[["8816f3d97fb78d19"]]},{"id":"cfdfc014a0af4c6c","type":"junction","z":"45c748a9bb3d89b9","x":1100,"y":380,"wires":[["4cf9747f6aeb4e16"]]},{"id":"6077df63b7a6777f","type":"junction","z":"45c748a9bb3d89b9","x":1100,"y":540,"wires":[["8c654e6585d20b9e"]]},{"id":"18bd68e96b736ee6","type":"junction","z":"65e9757c31af6de0","x":80,"y":580,"wires":[["a4e66bba0b79093f"]]},{"id":"af3d8092e49f02cd","type":"junction","z":"65e9757c31af6de0","x":80,"y":260,"wires":[["ec44014918f4a6be"]]},{"id":"d503691007fcd0ca","type":"junction","z":"65e9757c31af6de0","x":80,"y":420,"wires":[["cfe095ad4945e166"]]},{"id":"cf9f9b330ca57d06","type":"junction","z":"65e9757c31af6de0","x":1120,"y":380,"wires":[["d503691007fcd0ca"]]},{"id":"48378eaa9159a09d","type":"junction","z":"65e9757c31af6de0","x":980,"y":520,"wires":[["18bd68e96b736ee6"]]},{"id":"a6f3843058bd36f1","type":"junction","z":"65e9757c31af6de0","x":1240,"y":200,"wires":[["af3d8092e49f02cd"]]},{"id":"586901d2bc7ea4e9","type":"junction","z":"45c748a9bb3d89b9","g":"dffd493b5177004f","x":460,"y":440,"wires":[["ddfe1118bb0d76ac"]]},{"id":"b2aa1b69129eac7a","type":"junction","z":"65e9757c31af6de0","g":"b4f3fef5b6796d67","x":480,"y":440,"wires":[["3611e1c3ed2aa060"]]},{"id":"5c13e4731fd7f4cf","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":true,"alpnprotocol":""},{"id":"8dd94efcd0784de3","type":"MySQL-Server-Connector","name":"DB","host":"${DB_HOST}","port":"3306","user":"${DB_USER}","password":"${DB_PASS}","tls":false,"database":"${DB_DATABASE}"},{"id":"cf1640eea7a0abb6","type":"cronplus","z":"65e9757c31af6de0","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":140,"y":200,"wires":[["6d0ea4abbb2329f2"]]},{"id":"3b616abd29c57359","type":"inject","z":"65e9757c31af6de0","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":350,"y":960,"wires":[["eb306be7b237108b"]]},{"id":"eb306be7b237108b","type":"template","z":"65e9757c31af6de0","name":"Forespørgsel ↓\\n SELECT * FROM {{flow.tablename}}","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"SELECT *\nFROM {{flow.tablename}}","output":"str","x":650,"y":1000,"wires":[["1908f9f8c834ea16"]]},{"id":"5ee4d5af0539ef04","type":"debug","z":"65e9757c31af6de0","name":"debug 24","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1240,"y":1040,"wires":[]},{"id":"1908f9f8c834ea16","type":"link call","z":"65e9757c31af6de0","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":970,"y":1060,"wires":[["39564f07e745b838"]]},{"id":"39564f07e745b838","type":"json","z":"65e9757c31af6de0","name":"","property":"payload","action":"obj","pretty":false,"x":1115,"y":1060,"wires":[["5ee4d5af0539ef04"]],"l":false},{"id":"809c32664f38c123","type":"template","z":"65e9757c31af6de0","name":"Forespørgsel ↓\\n DROP TABLE {{flow.tablename}}","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"DROP TABLE {{flow.tablename}}","output":"str","x":590,"y":1140,"wires":[["1908f9f8c834ea16"]]},{"id":"f2a3e1a25258e2e9","type":"inject","z":"65e9757c31af6de0","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":360,"y":1140,"wires":[["809c32664f38c123"]]},{"id":"aec576b7c50a7dbb","type":"inject","z":"65e9757c31af6de0","g":"7a1be7166080e405","name":"Kør een gang \\n efter hvert nyt deploy","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","x":260,"y":100,"wires":[["6d0ea4abbb2329f2"]]},{"id":"6d0ea4abbb2329f2","type":"change","z":"65e9757c31af6de0","g":"7a1be7166080e405","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"flow","to":"dst_BIL54","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":100,"wires":[["b1303341834b49b1"]]},{"id":"38ca1cb7260a67fd","type":"link call","z":"65e9757c31af6de0","g":"7a1be7166080e405","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":1090,"y":100,"wires":[["a6f3843058bd36f1","8454274e375708cc"]]},{"id":"41fdc630ccb292a8","type":"json","z":"65e9757c31af6de0","g":"3a97118afcc37812","name":"","property":"payload","action":"","pretty":false,"x":675,"y":640,"wires":[["3083d0816f66aea2"]],"l":false},{"id":"be809a1b31c5ea46","type":"delay","z":"65e9757c31af6de0","g":"3a97118afcc37812","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"500","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":395,"y":640,"wires":[["8e4c5974c76b9636","47857da4895c34e2"]],"l":false},{"id":"8e4c5974c76b9636","type":"link call","z":"65e9757c31af6de0","g":"3a97118afcc37812","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":530,"y":640,"wires":[["41fdc630ccb292a8"]]},{"id":"3083d0816f66aea2","type":"join","z":"65e9757c31af6de0","g":"3a97118afcc37812","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":725,"y":640,"wires":[["78f61b8f9c10af7b"]],"l":false},{"id":"cfe095ad4945e166","type":"csv","z":"65e9757c31af6de0","g":"b4f3fef5b6796d67","name":"Konverter data ↓ \\n Fra semikolon separeret tekst til JSON","sep":";","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":290,"y":480,"wires":[["eb9e4a0ec396482a","b2aa1b69129eac7a"]]},{"id":"eb9e4a0ec396482a","type":"change","z":"65e9757c31af6de0","g":"b4f3fef5b6796d67","name":"Fjern overflødige \\n datafelter","rules":[{"t":"delete","p":"payload.OMRÅDE","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":480,"wires":[["4177dc7cb8ca7afc"]]},{"id":"4177dc7cb8ca7afc","type":"change","z":"65e9757c31af6de0","g":"b4f3fef5b6796d67","name":"Rens og oversæt datofelt \\n til iso8601","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"set","p":"data.maaned","pt":"msg","to":"$map(data.TID, function($v, $i, $a) {    $replace($substring($v,8),\"M\",\"-\") & \"-01\" })","tot":"jsonata"},{"t":"delete","p":"data.TID","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":480,"wires":[["48378eaa9159a09d"]]},{"id":"a4e66bba0b79093f","type":"template","z":"65e9757c31af6de0","g":"3a97118afcc37812","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{flow.tablename}} \n    (Måned, Biltype, Drivmiddel, Anvendelse, Antal)\nVALUES( \n        '{{{data.maaned}}}',\n        '{{{data.BILTYPE}}}',\n        '{{{data.DRIV}}}',\n        '{{{data.BRUG}}}',\n        '{{{data.INDHOLD}}}'\n        )\nON DUPLICATE KEY UPDATE\n    Antal = '{{{data.INDHOLD}}}'","output":"str","x":240,"y":640,"wires":[["be809a1b31c5ea46"]]},{"id":"b1303341834b49b1","type":"template","z":"65e9757c31af6de0","g":"7a1be7166080e405","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{flow.tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMåned DATE,\n\tBiltype varchar(256),\n\tDrivmiddel varchar(48),\n\tAnvendelse varchar(128),\n\tAntal INT,\n\tUNIQUE (Måned, Drivmiddel, Biltype, Anvendelse)\n\t);","output":"str","x":810,"y":100,"wires":[["38ca1cb7260a67fd"]]},{"id":"47857da4895c34e2","type":"debug","z":"65e9757c31af6de0","name":"debug 26","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1020,"y":580,"wires":[]},{"id":"3611e1c3ed2aa060","type":"join","z":"65e9757c31af6de0","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":975,"y":440,"wires":[["2703e838f7ffa120"]],"l":false},{"id":"1f733c3ff9a7a37b","type":"change","z":"65e9757c31af6de0","g":"8a2c08c2207f332c","name":"Oprydning i uaktuelle parametre","rules":[{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":320,"wires":[["cf9f9b330ca57d06"]]},{"id":"0a0ae1025f784e27","type":"http request","z":"65e9757c31af6de0","g":"8a2c08c2207f332c","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":650,"y":320,"wires":[["1f733c3ff9a7a37b"]]},{"id":"ec44014918f4a6be","type":"change","z":"65e9757c31af6de0","g":"8a2c08c2207f332c","name":"Opsætning af forespørgsel ↓ \\n Totalt antal indregistrerede biler i Randers Kommune \\n pr. måned, biltype, anvendelse og drivmiddel. ","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.statbank.dk/v1/data","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"table\":\"BIL54\",\"format\":\"CSV\",\"valuePresentation\":\"CodeAndValue\",\"variables\":[{\"code\":\"OMRÅDE\",\"values\":[\"730\"]},{\"code\":\"BILTYPE\",\"values\":[\"4000101002\",\"4000102000\"]},{\"code\":\"BRUG\",\"values\":[\"1100\",\"1200\"]},{\"code\":\"DRIV\",\"values\":[\"20205\",\"20210\",\"20215\",\"20220\",\"20225\",\"20230\",\"20231\",\"20232\",\"20235\"]},{\"code\":\"Tid\",\"values\":[\"*\"]}]}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":320,"wires":[["0a0ae1025f784e27"]]},{"id":"8454274e375708cc","type":"debug","z":"65e9757c31af6de0","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload.warningStatus = 0\t? { $flowContext(\"tablename\"): \"table created\" }:\tpayload.warningStatus = 1\t? { $flowContext(\"tablename\"): \"table exists\" }:\t{\"warningstatus\" : payload.warningStatus}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1300,"y":100,"wires":[]},{"id":"2703e838f7ffa120","type":"debug","z":"65e9757c31af6de0","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   \"target-table\" : $flowContext(\"tablename\"),\t   \"endpoint\" : url,\t   \"http-response-code\" : statusCode,\t   \"status\" : \"datapull complete\",\t   \"returned-rows\" : payload.total\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1080,"y":440,"wires":[]},{"id":"78f61b8f9c10af7b","type":"debug","z":"65e9757c31af6de0","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   $flowContext(\"tablename\") : \"data insert complete\",\t   \"inserted-rows\" : $count(payload)\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":860,"y":640,"wires":[]},{"id":"3ab26a708b54ccc2","type":"cronplus","z":"45c748a9bb3d89b9","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":140,"y":200,"wires":[["24aea33ae1a059ff"]]},{"id":"882eb84edb905d45","type":"inject","z":"45c748a9bb3d89b9","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":350,"y":960,"wires":[["3f564f0618713ea3"]]},{"id":"3f564f0618713ea3","type":"template","z":"45c748a9bb3d89b9","name":"Forespørgsel ↓\\n SELECT * FROM {{flow.tablename}}","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"SELECT *\nFROM {{flow.tablename}}","output":"str","x":650,"y":1000,"wires":[["c56c6c2b46ed54a1"]]},{"id":"8511ec2d320636d7","type":"debug","z":"45c748a9bb3d89b9","name":"debug 20","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1240,"y":1040,"wires":[]},{"id":"c56c6c2b46ed54a1","type":"link call","z":"45c748a9bb3d89b9","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":970,"y":1060,"wires":[["d5523d49c618f875"]]},{"id":"d5523d49c618f875","type":"json","z":"45c748a9bb3d89b9","name":"","property":"payload","action":"obj","pretty":false,"x":1115,"y":1060,"wires":[["8511ec2d320636d7"]],"l":false},{"id":"785b677220e55c7c","type":"template","z":"45c748a9bb3d89b9","name":"Forespørgsel ↓\\n DROP TABLE {{flow.tablename}}","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"DROP TABLE {{flow.tablename}}","output":"str","x":590,"y":1140,"wires":[["c56c6c2b46ed54a1"]]},{"id":"40ae97ca4bae17cb","type":"inject","z":"45c748a9bb3d89b9","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":360,"y":1140,"wires":[["785b677220e55c7c"]]},{"id":"6f0df73838f8a16d","type":"inject","z":"45c748a9bb3d89b9","g":"74accbadad317ac9","name":"Kør een gang \\n efter hvert nyt deploy","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"7","topic":"","x":260,"y":100,"wires":[["24aea33ae1a059ff"]]},{"id":"24aea33ae1a059ff","type":"change","z":"45c748a9bb3d89b9","g":"74accbadad317ac9","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"flow","to":"dst_AREALDK","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":100,"wires":[["8aa2da41c389bf11"]]},{"id":"a0e1ed04ee543327","type":"link call","z":"45c748a9bb3d89b9","g":"74accbadad317ac9","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":1090,"y":100,"wires":[["51c2c7e50c627a62","ee65cede2855c70e"]]},{"id":"8aa2da41c389bf11","type":"template","z":"45c748a9bb3d89b9","g":"74accbadad317ac9","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{flow.tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMåned DATE,\n\tArealtype varchar(256),\n\tAreal_km2 DECIMAL(4,1),\n\tUNIQUE (Måned, Arealtype)\n\t);","output":"str","x":790,"y":100,"wires":[["a0e1ed04ee543327"]]},{"id":"2c12abb429fa27f5","type":"json","z":"45c748a9bb3d89b9","g":"e305aa6360bd66a1","name":"","property":"payload","action":"","pretty":false,"x":665,"y":640,"wires":[["5d9c0209ba869676"]],"l":false},{"id":"36e6150307870585","type":"delay","z":"45c748a9bb3d89b9","g":"e305aa6360bd66a1","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"500","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":385,"y":640,"wires":[["5bc0075c1c938d7e"]],"l":false},{"id":"5bc0075c1c938d7e","type":"link call","z":"45c748a9bb3d89b9","g":"e305aa6360bd66a1","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":520,"y":640,"wires":[["2c12abb429fa27f5"]]},{"id":"5d9c0209ba869676","type":"join","z":"45c748a9bb3d89b9","g":"e305aa6360bd66a1","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":715,"y":640,"wires":[["1f5198ed3fd3b77c"]],"l":false},{"id":"e468dbc04e7bb1d3","type":"template","z":"45c748a9bb3d89b9","g":"e305aa6360bd66a1","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{flow.tablename}} \n    (Måned, Arealtype, Areal_km2)\nVALUES( \n        '{{{data.TID}}}',\n        '{{{data.ARE1}}}',\n        '{{{data.INDHOLD}}}'\n        )\nON DUPLICATE KEY UPDATE\n    Areal_km2 = '{{{data.INDHOLD}}}'","output":"str","x":240,"y":640,"wires":[["36e6150307870585"]]},{"id":"8816f3d97fb78d19","type":"csv","z":"45c748a9bb3d89b9","g":"dffd493b5177004f","name":"Konverter data ↓ \\n Fra semikolon separeret tekst til JSON","sep":";","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":290,"y":480,"wires":[["e67cc7cbad9479e6","586901d2bc7ea4e9"]]},{"id":"e67cc7cbad9479e6","type":"change","z":"45c748a9bb3d89b9","g":"dffd493b5177004f","name":"Fjern overflødige \\n datafelter","rules":[{"t":"delete","p":"payload.OMRÅDE","pt":"msg"},{"t":"delete","p":"payload.ENHED","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":480,"wires":[["7a1c64b88d033906"]]},{"id":"7a1c64b88d033906","type":"change","z":"45c748a9bb3d89b9","g":"dffd493b5177004f","name":"Rens og oversæt datofelt \\n til iso8601 og konverter areal til US decimal","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"set","p":"data.TID","pt":"msg","to":"data.TID & \"-12-01\"","tot":"jsonata"},{"t":"set","p":"data.INDHOLD","pt":"msg","to":"$number($replace(data.INDHOLD, \",\", \".\"))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":480,"wires":[["6077df63b7a6777f"]]},{"id":"ddfe1118bb0d76ac","type":"join","z":"45c748a9bb3d89b9","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1075,"y":460,"wires":[["83851b991764a3d9"]],"l":false},{"id":"c85839311d89a6fc","type":"change","z":"45c748a9bb3d89b9","g":"195346dcdad54c42","name":"Opsætning af forespørgsel ↓ \\n Totalt antal kvm2 skov og engarealer \\n i Randers Kommune for alle registrerede år","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.statbank.dk/v1/data","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"table\":\"AREALDK\",\"format\":\"CSV\",\"variables\":[{\"code\":\"OMRÅDE\",\"values\":[\"730\"]},{\"code\":\"ENHED\",\"values\":[\"0120\"]},{\"code\":\"Tid\",\"values\":[\"*\"]},{\"code\":\"ARE1\",\"values\":[\"E\",\"F2\"]}]}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":320,"wires":[["294694f536a9344a"]]},{"id":"627a6e96dd5e1fd6","type":"change","z":"45c748a9bb3d89b9","g":"195346dcdad54c42","name":"Oprydning i uaktuelle parametre","rules":[{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":320,"wires":[["cfdfc014a0af4c6c"]]},{"id":"294694f536a9344a","type":"http request","z":"45c748a9bb3d89b9","g":"195346dcdad54c42","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":630,"y":320,"wires":[["627a6e96dd5e1fd6"]]},{"id":"ee65cede2855c70e","type":"debug","z":"45c748a9bb3d89b9","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload.warningStatus = 0\t? { $flowContext(\"tablename\"): \"table created\" }:\tpayload.warningStatus = 1\t? { $flowContext(\"tablename\"): \"table exists\" }:\t{\"warningstatus\" : payload.warningStatus}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1300,"y":100,"wires":[]},{"id":"83851b991764a3d9","type":"debug","z":"45c748a9bb3d89b9","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   \"target-table\" : $flowContext(\"tablename\"),\t   \"endpoint\" : url,\t   \"http-response-code\" : statusCode,\t   \"status\" : \"datapull complete\",\t   \"returned-rows\" : payload.total\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1180,"y":460,"wires":[]},{"id":"1f5198ed3fd3b77c","type":"debug","z":"45c748a9bb3d89b9","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   $flowContext(\"tablename\") : \"data insert complete\",\t   \"inserted-rows\" : $count(payload)\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":860,"y":640,"wires":[]},{"id":"8c31ab219eb69506","type":"cronplus","z":"c57523bd9147a472","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":140,"y":200,"wires":[["71c08e72255922c6"]]},{"id":"3926f857306514b0","type":"debug","z":"c57523bd9147a472","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   \"endpoint\" : baseurl,\t   \"http-response-code\" : statusCode,\t   \"status\" : \"datapull complete\",\t   \"returned-rows\" : payload.total\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1040,"y":460,"wires":[]},{"id":"b32b085c2d36490a","type":"inject","z":"c57523bd9147a472","g":"7594e465324c4a7d","name":"Kør een gang \\n efter hvert nyt deploy","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"12","topic":"","x":260,"y":100,"wires":[["71c08e72255922c6"]]},{"id":"71c08e72255922c6","type":"change","z":"c57523bd9147a472","g":"7594e465324c4a7d","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"flow","to":"eds_FORBRUG","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":100,"wires":[["f6838a16d2e608d9"]]},{"id":"f6838a16d2e608d9","type":"template","z":"c57523bd9147a472","g":"7594e465324c4a7d","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{flow.tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMonth DATE,\n\tIndustrycode_DE35 VARCHAR(10),\n\tTotalConsumption INT,\n\tUNIQUE (Month, Industrycode_DE35)\n\t);","output":"str","x":790,"y":100,"wires":[["422fe331a1d9712d"]]},{"id":"422fe331a1d9712d","type":"link call","z":"c57523bd9147a472","g":"7594e465324c4a7d","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":1090,"y":120,"wires":[["2b035082d5a6ff72","031b0eb4a8a7e71e"]]},{"id":"9112c74df78eeb8d","type":"template","z":"c57523bd9147a472","g":"46586d3536cd47cc","name":"Forespørgsel ↓\\n Hent dato for seneste række ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"SELECT MAX(Month) as latest_month\nFROM {{flow.tablename}}","output":"str","x":260,"y":340,"wires":[["e0990e8cad6c838f"]]},{"id":"c8aa0d3e029ac7a2","type":"switch","z":"c57523bd9147a472","g":"46586d3536cd47cc","name":"Undersøg dato for \\n seneste række","property":"payload[0].latest_month","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":340,"wires":[["8d5e4351d2cf66d3"],["b92b3a2d80cc8ee8"]]},{"id":"8d5e4351d2cf66d3","type":"change","z":"c57523bd9147a472","g":"46586d3536cd47cc","name":"Hvis NULL sæt startdato to 2013","rules":[{"t":"set","p":"startdato","pt":"msg","to":"2013-01-01","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":300,"wires":[["e46f8006b6de0ec5"]]},{"id":"b92b3a2d80cc8ee8","type":"change","z":"c57523bd9147a472","g":"46586d3536cd47cc","name":"Fjern tidsstempel \\n og sæt startdato til dato-streng \\n for seneste række hentet","rules":[{"t":"set","p":"startdato","pt":"msg","to":"$substring($string(payload[0].latest_month), 1, 10)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":360,"wires":[["e46f8006b6de0ec5"]],"info":"Henter den fulde dato og tid fra den seneste række i databasen, konverterer til en teksstren og fjerner tidsstemplet.\nReturnerer derefter den rensede dato"},{"id":"e0990e8cad6c838f","type":"link call","z":"c57523bd9147a472","g":"46586d3536cd47cc","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":550,"y":340,"wires":[["c8aa0d3e029ac7a2"]]},{"id":"1117106bda48e1ac","type":"change","z":"c57523bd9147a472","g":"71f4232f84760c95","name":"Opsætning af forespørgsel ↓ \\n Elforbrug total i kwh pr. måned","rules":[{"t":"set","p":"baseurl","pt":"msg","to":"https://api.energidataservice.dk/dataset/ConsumptionpermunicipalityDE35","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"GET","tot":"str"},{"t":"set","p":"url","pt":"msg","to":"baseurl & \"?offset=0&start=\"&startdato&\"&end=now&filter=%7B%22MunicipalityNo%22:[%22730%22]%7D&sort=Month%20DESC&timezone=dk&limit=10000\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":500,"wires":[["f76c6798af9cfd95"]],"info":"Based on url query:\n\nhttps://api.energidataservice.dk/dataset/ConsumptionpermunicipalityDE35?offset=0&start=2013-01-01T00:00&end=2023-03-01T00:00&filter=%7B%22MunicipalityNo%22:[%22730%22]%7D&sort=Month%20DESC&timezone=dk"},{"id":"f76c6798af9cfd95","type":"http request","z":"c57523bd9147a472","g":"71f4232f84760c95","name":"Send forespørgsel","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":530,"y":500,"wires":[["ddaaed79ead52943","27623012081e2a39"]]},{"id":"ddaaed79ead52943","type":"change","z":"c57523bd9147a472","g":"71f4232f84760c95","name":"Oprydning i uaktuelle parametre","rules":[{"t":"delete","p":"url","pt":"msg"},{"t":"delete","p":"method","pt":"msg"},{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"responseUrl","pt":"msg"},{"t":"delete","p":"manualTrigger","pt":"msg"},{"t":"delete","p":"scheduledEvent","pt":"msg"},{"t":"delete","p":"redirectList","pt":"msg"},{"t":"delete","p":"statusCode","pt":"msg"},{"t":"delete","p":"sort","pt":"msg"},{"t":"delete","p":"object","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.records","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":500,"wires":[["96e0aebc629488f6"]]},{"id":"9ea86f7e0ce10f99","type":"change","z":"c57523bd9147a472","g":"808dce21ee927308","name":"Fjern overflødige \\n datafelter","rules":[{"t":"set","p":"data","pt":"msg","to":"{\t   \"Month\" : payload.Month,\t   \"Industrycode_DE35\": payload.Industrycode_DE35,\t   \"TotalConsumption\": payload.TotalCon\t}\t","tot":"jsonata"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":620,"wires":[["ffcaf5a90d067842"]]},{"id":"99165a843037b931","type":"split","z":"c57523bd9147a472","g":"808dce21ee927308","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":true,"addname":"","x":190,"y":620,"wires":[["9b7898c7088f9a4e"]]},{"id":"9b7898c7088f9a4e","type":"delay","z":"c57523bd9147a472","g":"808dce21ee927308","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"500","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":305,"y":620,"wires":[["9ea86f7e0ce10f99"]],"l":false},{"id":"a10bfbed8613f040","type":"json","z":"c57523bd9147a472","g":"5ec9e9daf7becd6b","name":"","property":"payload","action":"","pretty":false,"x":655,"y":760,"wires":[["692724b4ed7ce476"]],"l":false},{"id":"63f448e05f661eac","type":"template","z":"c57523bd9147a472","g":"5ec9e9daf7becd6b","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{flow.tablename}} \n    (Month,\tIndustrycode_DE35,TotalConsumption)\nVALUES( \n        '{{{data.Month}}}',\n        '{{{data.Industrycode_DE35}}}',\n        '{{data.TotalConsumption}}'\n        )\nON DUPLICATE KEY UPDATE\n    TotalConsumption = '{{data.TotalConsumption}}'","output":"str","x":240,"y":760,"wires":[["8da50384ff05535a"]]},{"id":"8da50384ff05535a","type":"delay","z":"c57523bd9147a472","g":"5ec9e9daf7becd6b","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"500","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":375,"y":760,"wires":[["bab3bc667b86d0dc"]],"l":false},{"id":"bab3bc667b86d0dc","type":"link call","z":"c57523bd9147a472","g":"5ec9e9daf7becd6b","name":"Send forespørgsel","links":["3f847e4f2e488027"],"linkType":"static","timeout":"30","x":510,"y":760,"wires":[["a10bfbed8613f040"]]},{"id":"692724b4ed7ce476","type":"join","z":"c57523bd9147a472","g":"5ec9e9daf7becd6b","name":"","mode":"auto","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":705,"y":760,"wires":[["90b70f3f5f1ded77"]],"l":false},{"id":"031b0eb4a8a7e71e","type":"debug","z":"c57523bd9147a472","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload.warningStatus = 0\t? { $flowContext(\"tablename\"): \"table created\" }:\tpayload.warningStatus = 1\t? { $flowContext(\"tablename\"): \"table exists\" }:\t{\"warningstatus\" : payload.warningStatus}","targetType":"jsonata","statusVal":"","statusType":"auto","x":1320,"y":120,"wires":[]},{"id":"90b70f3f5f1ded77","type":"debug","z":"c57523bd9147a472","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"{\t   $flowContext(\"tablename\") : \"data insert complete\",\t   \"inserted-rows\" : $count(payload)\t}","targetType":"jsonata","statusVal":"","statusType":"auto","x":840,"y":760,"wires":[]},{"id":"e67c1df924beb9a1","type":"cronplus","z":"8834f4e823c6a1a3","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":160,"y":100,"wires":[["5980dd1bcc61a463"]]},{"id":"7252b7c843956315","type":"inject","z":"8834f4e823c6a1a3","d":true,"name":"Run 40 seks efter deploy","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"40","topic":"","x":190,"y":40,"wires":[["e67c1df924beb9a1"]]},{"id":"76456d745e183b34","type":"change","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Opsætning af forespørgsel ↓ \\n Våd- og lavbundsområder i \\n Randers Kommune siden år 2000","rules":[{"t":"set","p":"url","pt":"msg","to":"https://admin.opendata.dk/api/3/action/datastore_search?resource_id=9b9398d7-b07f-4fc3-b95e-b7f0b7c87566","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"GET","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":240,"wires":[["d4cc21141f5b8593"]]},{"id":"d4cc21141f5b8593","type":"http request","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":530,"y":260,"wires":[["42362e792c0ccae4"]]},{"id":"6711cc6a4b81c08d","type":"debug","z":"8834f4e823c6a1a3","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":840,"y":720,"wires":[]},{"id":"447f39147089ad83","type":"json","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Formater data \\n som JSON","property":"payload","action":"","pretty":false,"x":960,"y":260,"wires":[["1f2d319f4929ac71"]]},{"id":"5faf844e177663ee","type":"MySQL-Connector","z":"8834f4e823c6a1a3","d":true,"g":"9072a48aa3a295a8","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":750,"y":540,"wires":[["3bb87be8a8c0c420"]]},{"id":"3bb87be8a8c0c420","type":"change","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Oprydning i \\n uaktuelle parametre","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":540,"wires":[["69d887b38b99f13c"]]},{"id":"65752c31a5522faf","type":"template","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tId NUMERIC,\n\tAarstal DATE,\n\tProjektområde varchar(256),\n\tStatus varchar(256),\n\tAreal_km2 DECIMAL(4,1),\n\tUNIQUE (id)\n\t);","output":"str","x":470,"y":540,"wires":[["c9fe3d3be6783787"]]},{"id":"d1f909b168e33c40","type":"change","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"opendata_lavbund","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":540,"wires":[["65752c31a5522faf"]]},{"id":"5362319b65082b0a","type":"MySQL-Connector","z":"8834f4e823c6a1a3","d":true,"g":"135076410a4b1b18","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":450,"y":720,"wires":[["57182fe99ae6760e"]]},{"id":"57182fe99ae6760e","type":"json","z":"8834f4e823c6a1a3","g":"135076410a4b1b18","name":"","property":"payload","action":"","pretty":false,"x":650,"y":720,"wires":[["6711cc6a4b81c08d"]]},{"id":"47bb8108ee8bcb77","type":"template","z":"8834f4e823c6a1a3","g":"135076410a4b1b18","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{tablename}} \n    (Id, Aarstal, Projektområde, Status, Areal_km2)\nVALUES( \n        '{{{data._id}}}',\n        '{{{data.aarstal}}}',\n        '{{{data.projektomr}}}',\n        '{{{data.status}}}',\n        '{{{data.areal_klima_ha}}}'\n\n        )\nON DUPLICATE KEY UPDATE\n    Areal_km2 = '{{{data.areal_klima_ha}}}'","output":"str","x":220,"y":720,"wires":[["5362319b65082b0a"]]},{"id":"d23c2161e5f2c8ca","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Rens og oversæt datofelt \\n til iso8601 og konverter Ha-streng til decimaltal","rules":[{"t":"set","p":"testdata","pt":"msg","to":"{\"_id\":1,\"ogc_fid\":2224,\"projektomr\":\"Lavbunds s. for Fårup\",\"status\":\"ngp_potentielle\",\"vandloebsnavn\":\"Skals Å\",\"vandloebssystem\":\"\",\"shape_wkt\":\"POLYGON ((550957.3255758903 6266870.013389035, 550980.8925757739 6266897.926076837, 551263.0280069966 6266954.754303506, 551341.2503895871 6266758.864063344, 551402.7585878632 6266775.243963972, 551416.1299353144 6266729.781382636, 551380.6958645683 6266723.09570891, 551428.4984317067 6266594.396489691, 551455.5754102957 6266601.416447103, 551507.3893816696 6266480.40575267, 551774.4820470096 6266614.119227182, 551798.2161887357 6266554.616731023, 551821.6160467755 6266566.985227416, 551831.644557364 6266555.285298398, 552083.6944568213 6266457.674462004, 552103.0829106257 6266458.00874569, 552188.6595343141 6266447.311667727, 552296.6331649838 6266414.217582787, 552297.9702997288 6266210.304534154, 552347.1100016125 6266227.018718469, 552388.3940368682 6266254.095697058, 552427.1709444771 6266287.69120753, 552488.6791427532 6266334.490923608, 552555.703021853 6266380.622072314, 552562.0544118924 6266383.964909178, 552565.0629650686 6266385.803469453, 552600.8313195009 6266408.20047643...\",\"aarstal\":2023,\"areal_klima_ha\":\"167,468614\"}","tot":"json"},{"t":"set","p":"data.aarstal","pt":"msg","to":"data.aarstal & \"-12-01\"","tot":"jsonata"},{"t":"set","p":"data.areal_klima_ha","pt":"msg","to":"$number($replace(data.areal_klima_ha, \",\", \".\"))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":389,"wires":[["6dd4f5c2593f3946"]]},{"id":"a6867a7bb823f3bf","type":"split","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Opdel data \\n i objekter","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":392,"y":389,"wires":[["122e767f6beb5d9c"]]},{"id":"5346920c94e7372c","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Udvælg datalinier","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.result.records","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":210,"y":389,"wires":[["a6867a7bb823f3bf"]]},{"id":"122e767f6beb5d9c","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Flyt opdelt data \\n til dataobjekt","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":569,"y":389,"wires":[["d23c2161e5f2c8ca"]]},{"id":"42362e792c0ccae4","type":"change","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Oprydning i  \\n uaktuelle parametre","rules":[{"t":"delete","p":"url","pt":"msg"},{"t":"delete","p":"method","pt":"msg"},{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":260,"wires":[["447f39147089ad83"]]},{"id":"c9fe3d3be6783787","type":"delay","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"5","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":615,"y":540,"wires":[["5faf844e177663ee"]],"l":false},{"id":"3f847e4f2e488027","type":"link in","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","name":"database","links":[],"x":115,"y":120,"wires":[["52e079e6119e62ca"]]},{"id":"52e079e6119e62ca","type":"MySQL-Connector","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":250,"y":120,"wires":[["639eedc003d9447d","acfdb72c96a033c1"]]},{"id":"a3742ded5fba6dee","type":"debug","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","name":"debug 13","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":620,"y":80,"wires":[]},{"id":"639eedc003d9447d","type":"json","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","name":"","property":"payload","action":"","pretty":false,"x":470,"y":80,"wires":[["a3742ded5fba6dee"]]},{"id":"3dc733d677d6b321","type":"link out","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","name":"link out 1","mode":"return","links":[],"x":625,"y":120,"wires":[]},{"id":"acfdb72c96a033c1","type":"change","z":"dbcc6c9bc30cc8ba","g":"9a408a2759ec3084","name":"fjern query","rules":[{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":120,"wires":[["3dc733d677d6b321"]]}]