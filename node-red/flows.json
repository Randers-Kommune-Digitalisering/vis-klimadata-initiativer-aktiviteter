[{"id":"beb51e0b8fca897f","type":"tab","label":"AREALDK api.statbank.dk","disabled":false,"info":"# Danmarks areal\n### Statistikken viser Danmarks areal fordelt efter kommuner og regioner, opgjort pr. 1. januar. \nFra 2011 er opgørelsen baseret på data fra Geodatastyrelsens matrikelregister.\nKun matrikulerede områder er medtaget ved opmålingen, hvilket medfører, at mange søer ikke er medtaget. '\nFor kommuner med umatrikulerede søer vil arealet derfor være faldet sammenlignet med tidligere. Pr. 1. januar 2011-2013 gælder yderligere for København og Frederiksberg, at vejene ikke er matrikuleret og derfor ikke indgår i det opmålte areal.\n\nhttps://www.dst.dk/da/Statistik/dokumentation/statistikdokumentation/arealregnskab/indhold","env":[]},{"id":"8834f4e823c6a1a3","type":"tab","label":"LAVBUND opendata.dk","disabled":false,"info":"# Våd- og lavbundsområder i Randers kommune siden år 2000\r\n### Etablerede våd- og lavbundsområder i Randers kommune fra år 2000 og frem\r\n\r\nhttps://www.opendata.dk/randers-kommune/vad-og-lavbundsomrader-i-randers-kommune-siden-ar-2000","env":[]},{"id":"fab488d10bc34cea","type":"tab","label":"BIL54 api.statbank.dk ","disabled":false,"info":"","env":[]},{"id":"56d6546b49429320","type":"group","z":"fab488d10bc34cea","name":"Forespørgsel til api.statbank.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["cd3f8d13b171e665","04de2f1bc9f3d7f0","7f633ffd0eeb6925"],"x":94,"y":175,"w":963,"h":130},{"id":"a4ffe43b4506127a","type":"group","z":"fab488d10bc34cea","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["f3ca62a5e2a10d1e","f62200177295c9cd","e94d0bcc2a6ca1a3"],"x":94,"y":327,"w":832,"h":106},{"id":"e2663cd400512ad4","type":"group","z":"fab488d10bc34cea","name":"Database opsætning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["dce67bdeb004e01c","5d76679f26804846","db7f63eb8e7c7d9c","7f726eff61b37445","3ce804f1f05ab672"],"x":94,"y":455,"w":1032,"h":130},{"id":"789591867e638ff3","type":"group","z":"fab488d10bc34cea","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["cdeea154fc5d0890","651795baa51e5f8b","b538634215609a5f"],"x":94,"y":615,"w":632,"h":130},{"id":"6e7a468eaacb3121","type":"group","z":"8834f4e823c6a1a3","name":"Forespørgsel til admin.opendata.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["76456d745e183b34","d4cc21141f5b8593","447f39147089ad83","42362e792c0ccae4"],"x":94,"y":175,"w":972,"h":138},{"id":"9072a48aa3a295a8","type":"group","z":"8834f4e823c6a1a3","name":"Database opsætning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["5faf844e177663ee","3bb87be8a8c0c420","65752c31a5522faf","d1f909b168e33c40","c9fe3d3be6783787"],"x":94,"y":475,"w":992,"h":130},{"id":"135076410a4b1b18","type":"group","z":"8834f4e823c6a1a3","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["5362319b65082b0a","57182fe99ae6760e","47bb8108ee8bcb77"],"x":94,"y":655,"w":632,"h":130},{"id":"f21554e84cd0d748","type":"group","z":"8834f4e823c6a1a3","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["d23c2161e5f2c8ca","a6867a7bb823f3bf","5346920c94e7372c","122e767f6beb5d9c"],"x":94,"y":336,"w":972,"h":106},{"id":"3404831857b4a2df","type":"group","z":"beb51e0b8fca897f","name":"Forespørgsel til api.statbank.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["5fba67ce1813785d","6fbc13b3a3451cec","aa8153c0783bbf40"],"x":94,"y":255,"w":963,"h":130},{"id":"7263d0b1380953c1","type":"group","z":"beb51e0b8fca897f","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["b7693eae90ecd6c7","b2cf75d79d9d700d","50ce633653a7dc6d"],"x":94,"y":407,"w":952,"h":106},{"id":"ad124ac9c993c2ae","type":"group","z":"beb51e0b8fca897f","name":"Database opsætning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["7a27d2f587f6dcd1","670b26075d72f2e7","2a72f88eaff54ef7","fd7de6ff35419c21","d4ebfc92a0326f17"],"x":94,"y":535,"w":1072,"h":130},{"id":"3cae2023e72e0919","type":"group","z":"beb51e0b8fca897f","name":"Skrivning af data til database","style":{"label":true,"stroke":"none","fill":"#ffefbf","fill-opacity":"0.5"},"nodes":["cfa981ebe33331ce","a6908ce6c3d5cdc2","7ae55e4a7cc127bc","d123329ead6f1269"],"x":94,"y":695,"w":832,"h":130},{"id":"2e7411fd12f42592","type":"group","z":"beb51e0b8fca897f","name":"Initiel kørsel efter deployment - kører kun 1 gang","style":{"stroke":"none","fill":"#bfdbef","label":true,"color":"#7f7f7f","fill-opacity":"0.5"},"nodes":["18594e986be42b14","95b60150e2c18d4e","178ee68b41e3a64c","a2035642370489b7","f8f529b701a7b9aa","9b0bd1e0c85de3fe","bd6753c50fdc806f"],"x":94,"y":47,"w":1432,"h":106},{"id":"bc9a58d6735d2e06","type":"group","z":"beb51e0b8fca897f","name":"Database opsætning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["26c5079106003dd4","29dc3066e2bb5143","b332b0a2b3dbf1fb","428f7356db4c5b31","95708dabd14152e2"],"x":314,"y":935,"w":1112,"h":130},{"id":"a832b396336b3d04","type":"junction","z":"fab488d10bc34cea","x":60,"y":200,"wires":[["cd3f8d13b171e665"]]},{"id":"c55b4b4738487766","type":"junction","z":"fab488d10bc34cea","x":60,"y":340,"wires":[["f62200177295c9cd"]]},{"id":"ef88f12691dbefcc","type":"junction","z":"fab488d10bc34cea","x":60,"y":460,"wires":[["7f726eff61b37445"]]},{"id":"b94be5b4dfe21a7f","type":"junction","z":"fab488d10bc34cea","x":60,"y":620,"wires":[["b538634215609a5f"]]},{"id":"136e35dedbe5cb22","type":"junction","z":"fab488d10bc34cea","x":1100,"y":580,"wires":[["b94be5b4dfe21a7f"]]},{"id":"bdff64ede6405682","type":"junction","z":"fab488d10bc34cea","x":1080,"y":300,"wires":[["c55b4b4738487766"]]},{"id":"ec71dd3c6b5ee70d","type":"junction","z":"fab488d10bc34cea","x":400,"y":100,"wires":[["a832b396336b3d04"]]},{"id":"d7862099e66003e8","type":"junction","z":"fab488d10bc34cea","x":920,"y":400,"wires":[["ef88f12691dbefcc"]]},{"id":"5980dd1bcc61a463","type":"junction","z":"8834f4e823c6a1a3","x":360,"y":120,"wires":[["db31d2bd175ea824"]]},{"id":"db31d2bd175ea824","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":180,"wires":[["76456d745e183b34"]]},{"id":"e882301a1d27066d","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":340,"wires":[["5346920c94e7372c"]]},{"id":"0710567a0b7e455c","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":480,"wires":[["d1f909b168e33c40"]]},{"id":"1f2d319f4929ac71","type":"junction","z":"8834f4e823c6a1a3","x":1100,"y":280,"wires":[["e882301a1d27066d"]]},{"id":"6dd4f5c2593f3946","type":"junction","z":"8834f4e823c6a1a3","x":1120,"y":440,"wires":[["0710567a0b7e455c"]]},{"id":"b17360901cb08980","type":"junction","z":"8834f4e823c6a1a3","x":60,"y":660,"wires":[["47bb8108ee8bcb77"]]},{"id":"69d887b38b99f13c","type":"junction","z":"8834f4e823c6a1a3","x":1080,"y":600,"wires":[["b17360901cb08980"]]},{"id":"e4112ae5501c9ce9","type":"junction","z":"beb51e0b8fca897f","x":60,"y":280,"wires":[["5fba67ce1813785d"]]},{"id":"5e5c809e657dc1d1","type":"junction","z":"beb51e0b8fca897f","x":80,"y":420,"wires":[["b7693eae90ecd6c7"]]},{"id":"c347de401b5dc684","type":"junction","z":"beb51e0b8fca897f","x":60,"y":540,"wires":[["d4ebfc92a0326f17"]]},{"id":"677a9583722a13c7","type":"junction","z":"beb51e0b8fca897f","x":60,"y":700,"wires":[["a6908ce6c3d5cdc2"]]},{"id":"e552bd0e127adabb","type":"junction","z":"beb51e0b8fca897f","x":1220,"y":660,"wires":[["677a9583722a13c7"]]},{"id":"d897a2b2e3e8ea98","type":"junction","z":"beb51e0b8fca897f","x":1080,"y":380,"wires":[["5e5c809e657dc1d1"]]},{"id":"6addc82f94fdfc8d","type":"junction","z":"beb51e0b8fca897f","x":1060,"y":500,"wires":[["c347de401b5dc684"]]},{"id":"08490fdecedeef95","type":"junction","z":"beb51e0b8fca897f","x":360,"y":200,"wires":[["e4112ae5501c9ce9"]]},{"id":"5c13e4731fd7f4cf","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":true,"alpnprotocol":""},{"id":"8dd94efcd0784de3","type":"MySQL-Server-Connector","name":"DB","host":"${DB_HOST}","port":"3306","user":"${DB_USER}","password":"${DB_PASS}","tls":false,"database":"${DB_DATABASE}"},{"id":"69cb0545b760c5a5","type":"cronplus","z":"beb51e0b8fca897f","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":220,"y":200,"wires":[["08490fdecedeef95"]]},{"id":"d123329ead6f1269","type":"debug","z":"beb51e0b8fca897f","g":"3cae2023e72e0919","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":820,"y":760,"wires":[]},{"id":"18594e986be42b14","type":"inject","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"Kør een gang 1 sekund \\n efter deploy-time","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":240,"y":100,"wires":[["f8f529b701a7b9aa"]]},{"id":"5fba67ce1813785d","type":"change","z":"beb51e0b8fca897f","g":"3404831857b4a2df","name":"Opsætning af forespørgsel ↓ \\n Totalt antal kvm2 skov og engarealer \\n i Randers Kommune for alle registrerede år","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.statbank.dk/v1/data","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"table\":\"AREALDK\",\"format\":\"CSV\",\"variables\":[{\"code\":\"OMRÅDE\",\"values\":[\"730\"]},{\"code\":\"ENHED\",\"values\":[\"0120\"]},{\"code\":\"Tid\",\"values\":[\"*\"]},{\"code\":\"ARE1\",\"values\":[\"E\",\"F2\"]}]}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":320,"wires":[["6fbc13b3a3451cec"]]},{"id":"6fbc13b3a3451cec","type":"http request","z":"beb51e0b8fca897f","g":"3404831857b4a2df","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":641,"y":334,"wires":[["aa8153c0783bbf40"]]},{"id":"aa8153c0783bbf40","type":"change","z":"beb51e0b8fca897f","g":"3404831857b4a2df","name":"Oprydning i uaktuelle parametre","rules":[{"t":"delete","p":"url","pt":"msg"},{"t":"delete","p":"method","pt":"msg"},{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":901,"y":334,"wires":[["d897a2b2e3e8ea98"]]},{"id":"b7693eae90ecd6c7","type":"csv","z":"beb51e0b8fca897f","g":"7263d0b1380953c1","name":"Konverter data ↓ \\n Fra semikolon separeret tekst til JSON","sep":";","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":270,"y":460,"wires":[["b2cf75d79d9d700d"]]},{"id":"b2cf75d79d9d700d","type":"change","z":"beb51e0b8fca897f","g":"7263d0b1380953c1","name":"Fjern overflødige \\n datafelter","rules":[{"t":"delete","p":"payload.OMRÅDE","pt":"msg"},{"t":"delete","p":"payload.ENHED","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":460,"wires":[["50ce633653a7dc6d"]]},{"id":"50ce633653a7dc6d","type":"change","z":"beb51e0b8fca897f","g":"7263d0b1380953c1","name":"Rens og oversæt datofelt \\n til iso8601 og konverter areal til US decimal","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"set","p":"data.TID","pt":"msg","to":"data.TID & \"-12-01\"","tot":"jsonata"},{"t":"set","p":"data.INDHOLD","pt":"msg","to":"$number($replace(data.INDHOLD, \",\", \".\"))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":460,"wires":[["6addc82f94fdfc8d"]]},{"id":"7a27d2f587f6dcd1","type":"MySQL-Connector","z":"beb51e0b8fca897f","g":"ad124ac9c993c2ae","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":790,"y":600,"wires":[["670b26075d72f2e7"]]},{"id":"670b26075d72f2e7","type":"change","z":"beb51e0b8fca897f","g":"ad124ac9c993c2ae","name":"Oprydning i \\n uaktuelle parametre","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":600,"wires":[["e552bd0e127adabb"]]},{"id":"2a72f88eaff54ef7","type":"template","z":"beb51e0b8fca897f","g":"ad124ac9c993c2ae","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMåned DATE,\n\tArealtype varchar(256),\n\tAreal_km2 DECIMAL(4,1),\n\tUNIQUE (Måned, Arealtype)\n\t);","output":"str","x":470,"y":600,"wires":[["fd7de6ff35419c21"]]},{"id":"cfa981ebe33331ce","type":"MySQL-Connector","z":"beb51e0b8fca897f","g":"3cae2023e72e0919","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":470,"y":760,"wires":[["7ae55e4a7cc127bc"]]},{"id":"a6908ce6c3d5cdc2","type":"template","z":"beb51e0b8fca897f","g":"3cae2023e72e0919","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{tablename}} \n    (Måned, Arealtype, Areal_km2)\nVALUES( \n        '{{{data.TID}}}',\n        '{{{data.ARE1}}}',\n        '{{{data.INDHOLD}}}'\n        )\nON DUPLICATE KEY UPDATE\n    Areal_km2 = '{{{data.INDHOLD}}}'","output":"str","x":220,"y":760,"wires":[["cfa981ebe33331ce"]]},{"id":"95b60150e2c18d4e","type":"MySQL-Connector","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":1030,"y":100,"wires":[["08490fdecedeef95","bd6753c50fdc806f"]]},{"id":"178ee68b41e3a64c","type":"debug","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1420,"y":100,"wires":[]},{"id":"a2035642370489b7","type":"template","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"Database patch ↓\\n Drop tabel ved ny release","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"DROP TABLE {{tablename}}","output":"str","x":730,"y":100,"wires":[["9b0bd1e0c85de3fe"]]},{"id":"f8f529b701a7b9aa","type":"change","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"dst_AREALDK","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":100,"wires":[["a2035642370489b7"]]},{"id":"fd7de6ff35419c21","type":"delay","z":"beb51e0b8fca897f","g":"ad124ac9c993c2ae","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":635,"y":600,"wires":[["7a27d2f587f6dcd1"]],"l":false},{"id":"9b0bd1e0c85de3fe","type":"delay","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"5","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":875,"y":100,"wires":[["95b60150e2c18d4e"]],"l":false},{"id":"26c5079106003dd4","type":"MySQL-Connector","z":"beb51e0b8fca897f","g":"bc9a58d6735d2e06","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":1090,"y":1000,"wires":[["29dc3066e2bb5143"]]},{"id":"29dc3066e2bb5143","type":"change","z":"beb51e0b8fca897f","g":"bc9a58d6735d2e06","name":"Oprydning i \\n uaktuelle parametre","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":1000,"wires":[["4aaac48bed390758"]]},{"id":"b332b0a2b3dbf1fb","type":"template","z":"beb51e0b8fca897f","g":"bc9a58d6735d2e06","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMåned DATE,\n\tArealtype varchar(256),\n\tAreal_km2 DECIMAL(4,1),\n\tUNIQUE (Måned)\n\t);","output":"str","x":690,"y":1000,"wires":[["95708dabd14152e2"]]},{"id":"428f7356db4c5b31","type":"change","z":"beb51e0b8fca897f","g":"bc9a58d6735d2e06","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"dst_AREALDK","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":1000,"wires":[["b332b0a2b3dbf1fb"]]},{"id":"95708dabd14152e2","type":"delay","z":"beb51e0b8fca897f","g":"bc9a58d6735d2e06","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"5","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":910,"y":1000,"wires":[["26c5079106003dd4"]]},{"id":"c65cd2fcc2a756ab","type":"inject","z":"beb51e0b8fca897f","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":180,"y":1000,"wires":[["428f7356db4c5b31"]]},{"id":"4aaac48bed390758","type":"debug","z":"beb51e0b8fca897f","name":"debug 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1520,"y":1000,"wires":[]},{"id":"bd6753c50fdc806f","type":"json","z":"beb51e0b8fca897f","g":"2e7411fd12f42592","name":"","property":"payload","action":"","pretty":true,"x":1270,"y":100,"wires":[["178ee68b41e3a64c"]]},{"id":"d4ebfc92a0326f17","type":"change","z":"beb51e0b8fca897f","g":"ad124ac9c993c2ae","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"dst_AREALDK","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":600,"wires":[["2a72f88eaff54ef7"]]},{"id":"7ae55e4a7cc127bc","type":"json","z":"beb51e0b8fca897f","g":"3cae2023e72e0919","name":"","property":"payload","action":"","pretty":false,"x":650,"y":760,"wires":[["d123329ead6f1269"]]},{"id":"e67c1df924beb9a1","type":"cronplus","z":"8834f4e823c6a1a3","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"schedule1","topic":"topic1","payloadType":"default","payload":"","expressionType":"cron","expression":"0  0  1  1  *  ","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":160,"y":100,"wires":[["5980dd1bcc61a463"]]},{"id":"7252b7c843956315","type":"inject","z":"8834f4e823c6a1a3","name":"Kør een gang 15 sekunder efter deploy","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"15","topic":"","x":240,"y":40,"wires":[["e67c1df924beb9a1"]]},{"id":"76456d745e183b34","type":"change","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Opsætning af forespørgsel ↓ \\n Våd- og lavbundsområder i \\n Randers Kommune siden år 2000","rules":[{"t":"set","p":"url","pt":"msg","to":"https://admin.opendata.dk/api/3/action/datastore_search?resource_id=9b9398d7-b07f-4fc3-b95e-b7f0b7c87566","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"GET","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":240,"wires":[["d4cc21141f5b8593"]]},{"id":"d4cc21141f5b8593","type":"http request","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":530,"y":260,"wires":[["42362e792c0ccae4"]]},{"id":"6711cc6a4b81c08d","type":"debug","z":"8834f4e823c6a1a3","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":840,"y":720,"wires":[]},{"id":"447f39147089ad83","type":"json","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Formater data \\n som JSON","property":"payload","action":"","pretty":false,"x":960,"y":260,"wires":[["1f2d319f4929ac71"]]},{"id":"5faf844e177663ee","type":"MySQL-Connector","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":750,"y":540,"wires":[["3bb87be8a8c0c420"]]},{"id":"3bb87be8a8c0c420","type":"change","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Oprydning i \\n uaktuelle parametre","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":540,"wires":[["69d887b38b99f13c"]]},{"id":"65752c31a5522faf","type":"template","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tId NUMERIC,\n\tAarstal DATE,\n\tProjektområde varchar(256),\n\tStatus varchar(256),\n\tAreal_km2 DECIMAL(4,1),\n\tUNIQUE (id)\n\t);","output":"str","x":470,"y":540,"wires":[["c9fe3d3be6783787"]]},{"id":"d1f909b168e33c40","type":"change","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"opendata_lavbund","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":540,"wires":[["65752c31a5522faf"]]},{"id":"5362319b65082b0a","type":"MySQL-Connector","z":"8834f4e823c6a1a3","g":"135076410a4b1b18","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":450,"y":720,"wires":[["57182fe99ae6760e"]]},{"id":"57182fe99ae6760e","type":"json","z":"8834f4e823c6a1a3","g":"135076410a4b1b18","name":"","property":"payload","action":"","pretty":false,"x":650,"y":720,"wires":[["6711cc6a4b81c08d"]]},{"id":"47bb8108ee8bcb77","type":"template","z":"8834f4e823c6a1a3","g":"135076410a4b1b18","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{tablename}} \n    (Id, Aarstal, Projektområde, Status, Areal_km2)\nVALUES( \n        '{{{data._id}}}',\n        '{{{data.aarstal}}}',\n        '{{{data.projektomr}}}',\n        '{{{data.status}}}',\n        '{{{data.areal_klima_ha}}}'\n\n        )\nON DUPLICATE KEY UPDATE\n    Areal_km2 = '{{{data.areal_klima_ha}}}'","output":"str","x":220,"y":720,"wires":[["5362319b65082b0a"]]},{"id":"d23c2161e5f2c8ca","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Rens og oversæt datofelt \\n til iso8601 og konverter Ha-streng til decimaltal","rules":[{"t":"set","p":"testdata","pt":"msg","to":"{\"_id\":1,\"ogc_fid\":2224,\"projektomr\":\"Lavbunds s. for Fårup\",\"status\":\"ngp_potentielle\",\"vandloebsnavn\":\"Skals Å\",\"vandloebssystem\":\"\",\"shape_wkt\":\"POLYGON ((550957.3255758903 6266870.013389035, 550980.8925757739 6266897.926076837, 551263.0280069966 6266954.754303506, 551341.2503895871 6266758.864063344, 551402.7585878632 6266775.243963972, 551416.1299353144 6266729.781382636, 551380.6958645683 6266723.09570891, 551428.4984317067 6266594.396489691, 551455.5754102957 6266601.416447103, 551507.3893816696 6266480.40575267, 551774.4820470096 6266614.119227182, 551798.2161887357 6266554.616731023, 551821.6160467755 6266566.985227416, 551831.644557364 6266555.285298398, 552083.6944568213 6266457.674462004, 552103.0829106257 6266458.00874569, 552188.6595343141 6266447.311667727, 552296.6331649838 6266414.217582787, 552297.9702997288 6266210.304534154, 552347.1100016125 6266227.018718469, 552388.3940368682 6266254.095697058, 552427.1709444771 6266287.69120753, 552488.6791427532 6266334.490923608, 552555.703021853 6266380.622072314, 552562.0544118924 6266383.964909178, 552565.0629650686 6266385.803469453, 552600.8313195009 6266408.20047643...\",\"aarstal\":2023,\"areal_klima_ha\":\"167,468614\"}","tot":"json"},{"t":"set","p":"data.aarstal","pt":"msg","to":"data.aarstal & \"-12-01\"","tot":"jsonata"},{"t":"set","p":"data.areal_klima_ha","pt":"msg","to":"$number($replace(data.areal_klima_ha, \",\", \".\"))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":389,"wires":[["6dd4f5c2593f3946"]]},{"id":"a6867a7bb823f3bf","type":"split","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Opdel data \\n i objekter","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":392,"y":389,"wires":[["122e767f6beb5d9c"]]},{"id":"5346920c94e7372c","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Udvælg datalinier","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.result.records","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":210,"y":389,"wires":[["a6867a7bb823f3bf"]]},{"id":"122e767f6beb5d9c","type":"change","z":"8834f4e823c6a1a3","g":"f21554e84cd0d748","name":"Flyt opdelt data \\n til dataobjekt","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":569,"y":389,"wires":[["d23c2161e5f2c8ca"]]},{"id":"42362e792c0ccae4","type":"change","z":"8834f4e823c6a1a3","g":"6e7a468eaacb3121","name":"Oprydning i  \\n uaktuelle parametre","rules":[{"t":"delete","p":"url","pt":"msg"},{"t":"delete","p":"method","pt":"msg"},{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":260,"wires":[["447f39147089ad83"]]},{"id":"c9fe3d3be6783787","type":"delay","z":"8834f4e823c6a1a3","g":"9072a48aa3a295a8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":615,"y":540,"wires":[["5faf844e177663ee"]],"l":false},{"id":"f3ca62a5e2a10d1e","type":"change","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Rens og oversæt datofelt \\n til iso8601","rules":[{"t":"move","p":"payload","pt":"msg","to":"data","tot":"msg"},{"t":"set","p":"data.maaned","pt":"msg","to":"$map(data.TID, function($v, $i, $a) {    $replace($substring($v,8),\"M\",\"-\") & \"-01\" })","tot":"jsonata"},{"t":"delete","p":"data.TID","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":380,"wires":[["d7862099e66003e8"]]},{"id":"f62200177295c9cd","type":"csv","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Konverter data ↓ \\n Fra semikolon separeret tekst til JSON","sep":";","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":270,"y":380,"wires":[["e94d0bcc2a6ca1a3"]]},{"id":"cd3f8d13b171e665","type":"change","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"Opsætning af forespørgsel ↓ \\n Totalt antal indregistrerede biler i Randers Kommune \\n pr. måned, biltype, anvendelse og drivmiddel. ","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.statbank.dk/v1/data","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"table\":\"BIL54\",\"format\":\"CSV\",\"valuePresentation\":\"CodeAndValue\",\"variables\":[{\"code\":\"OMRÅDE\",\"values\":[\"730\"]},{\"code\":\"BILTYPE\",\"values\":[\"4000101002\",\"4000102000\"]},{\"code\":\"BRUG\",\"values\":[\"1100\",\"1200\"]},{\"code\":\"DRIV\",\"values\":[\"20205\",\"20210\",\"20215\",\"20220\",\"20225\",\"20230\",\"20231\",\"20232\",\"20235\"]},{\"code\":\"Tid\",\"values\":[\"*\"]}]}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":240,"wires":[["04de2f1bc9f3d7f0"]]},{"id":"04de2f1bc9f3d7f0","type":"http request","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"Send forespørgsel","method":"use","ret":"txt","paytoqs":"ignore","url":"","tls":"5c13e4731fd7f4cf","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":641,"y":254,"wires":[["7f633ffd0eeb6925"]]},{"id":"7f633ffd0eeb6925","type":"change","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"Oprydning i uaktuelle parametre","rules":[{"t":"delete","p":"url","pt":"msg"},{"t":"delete","p":"method","pt":"msg"},{"t":"delete","p":"headers","pt":"msg"},{"t":"delete","p":"cronplus","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":901,"y":254,"wires":[["bdff64ede6405682"]]},{"id":"dce67bdeb004e01c","type":"MySQL-Connector","z":"fab488d10bc34cea","g":"e2663cd400512ad4","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":770,"y":520,"wires":[["5d76679f26804846"]]},{"id":"cdeea154fc5d0890","type":"MySQL-Connector","z":"fab488d10bc34cea","g":"789591867e638ff3","server":"8dd94efcd0784de3","name":"Send forespørgsel","x":470,"y":680,"wires":[["651795baa51e5f8b"]]},{"id":"651795baa51e5f8b","type":"json","z":"fab488d10bc34cea","g":"789591867e638ff3","name":"","property":"payload","action":"","pretty":false,"x":650,"y":680,"wires":[["1bfb8f74fc912819"]]},{"id":"7ad3fa7f.e3acd4","type":"cronplus","z":"fab488d10bc34cea","name":"Scheduled run","outputField":"payload","timeZone":"","persistDynamic":false,"commandResponseMsgOutput":"output1","outputs":1,"options":[{"name":"Pull data from BIL54","topic":"run","payloadType":"date","payload":"","expressionType":"cron","expression":"0 0 9 ? * MON#3 *","location":"","offset":"0","solarType":"all","solarEvents":"sunrise,sunset"}],"x":160,"y":100,"wires":[["ec71dd3c6b5ee70d"]]},{"id":"e94d0bcc2a6ca1a3","type":"change","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Fjern overflødige \\n datafelter","rules":[{"t":"delete","p":"payload.OMRÅDE","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":380,"wires":[["f3ca62a5e2a10d1e"]]},{"id":"5d76679f26804846","type":"change","z":"fab488d10bc34cea","g":"e2663cd400512ad4","name":"Oprydning i \\n uaktuelle parametre","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":520,"wires":[["136e35dedbe5cb22"]]},{"id":"b538634215609a5f","type":"template","z":"fab488d10bc34cea","g":"789591867e638ff3","name":"Forespørgsel ↓\\n Indsæt eller opdater \\n data i tabel","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"INSERT INTO {{tablename}} \n    (Måned, Biltype, Drivmiddel, Anvendelse, Antal)\nVALUES( \n        '{{{data.maaned}}}',\n        '{{{data.BILTYPE}}}',\n        '{{{data.DRIV}}}',\n        '{{{data.BRUG}}}',\n        '{{{data.INDHOLD}}}'\n        )\nON DUPLICATE KEY UPDATE\n    Antal = '{{{data.INDHOLD}}}'","output":"str","x":220,"y":680,"wires":[["cdeea154fc5d0890"]]},{"id":"1bfb8f74fc912819","type":"debug","z":"fab488d10bc34cea","name":"stdout","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":680,"wires":[]},{"id":"db7f63eb8e7c7d9c","type":"template","z":"fab488d10bc34cea","g":"e2663cd400512ad4","name":"Forespørgsel ↓\\n Opret tabel hvis der ikke \\n eksisterer en i forvejen ","field":"topic","fieldType":"msg","format":"sql","syntax":"mustache","template":"CREATE TABLE if not exists {{tablename}} (\n\tcreated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\tlast_updated TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n\tMåned DATE,\n\tBiltype varchar(256),\n\tDrivmiddel varchar(48),\n\tAnvendelse varchar(128),\n\tAntal INT,\n\tUNIQUE (Måned, Drivmiddel, Biltype, Anvendelse)\n\t);","output":"str","x":470,"y":520,"wires":[["3ce804f1f05ab672"]]},{"id":"7f726eff61b37445","type":"change","z":"fab488d10bc34cea","g":"e2663cd400512ad4","name":"Konfigurer tabelnavn","rules":[{"t":"set","p":"tablename","pt":"msg","to":"dst_BIL54","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":520,"wires":[["db7f63eb8e7c7d9c"]]},{"id":"57c6a0bcf4804263","type":"inject","z":"fab488d10bc34cea","name":"Kør een gang 25 sekunder efter deploy-time","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"25","topic":"","x":250,"y":40,"wires":[["7ad3fa7f.e3acd4"]]},{"id":"3ce804f1f05ab672","type":"delay","z":"fab488d10bc34cea","g":"e2663cd400512ad4","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"10","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":625,"y":520,"wires":[["dce67bdeb004e01c"]],"l":false}]