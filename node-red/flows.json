[{"id":"fab488d10bc34cea","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"56d6546b49429320","type":"group","z":"fab488d10bc34cea","name":"Forespørgsel til api.statbank.dk","style":{"label":true,"stroke":"none","fill":"#e3f3d3","fill-opacity":"0.5","color":"#7f7f7f"},"nodes":["48130d7525318156","32b450c086bd606d","7b7bda592abc184a","cd3f8d13b171e665"],"x":236,"y":37,"w":932,"h":146},{"id":"e2663cd400512ad4","type":"group","z":"fab488d10bc34cea","name":"Database opsætning og skrivning","style":{"label":true,"stroke":"none","fill":"#dbcbe7","fill-opacity":"0.47"},"nodes":["591118e9649d8bb1","59254d4ebaf981fa"],"x":237,"y":350,"w":542,"h":82},{"id":"a4ffe43b4506127a","type":"group","z":"fab488d10bc34cea","name":"Datavask og filtrering","style":{"stroke":"none","stroke-opacity":"0.5","label":true,"fill":"#ffefbf","fill-opacity":"0.49"},"nodes":["f3ca62a5e2a10d1e","f8f237e2d239c7b5","4e1817195ba88e18","6dc1600ef156a1e0","f62200177295c9cd"],"x":234,"y":199,"w":812,"h":122},{"id":"f17bc4dde7e00d72","type":"junction","z":"fab488d10bc34cea","x":180,"y":360,"wires":[["59254d4ebaf981fa"]]},{"id":"5c13e4731fd7f4cf","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false,"alpnprotocol":""},{"id":"8dd94efcd0784de3","type":"MySQL-Server-Connector","name":"DB","host":"${DB_HOST}","port":"3306","user":"${DB_USER}","password":"${DB_PASS}","tls":true,"database":"${DB_NAME}"},{"id":"3ca0e991a672d285","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false,"alpnprotocol":""},{"id":"dc4ed562af8c0c11","type":"inject","z":"fab488d10bc34cea","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":80,"wires":[["cd3f8d13b171e665"]]},{"id":"48130d7525318156","type":"debug","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"debug 1","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1052,"y":78,"wires":[]},{"id":"32b450c086bd606d","type":"change","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"","rules":[{"t":"set","p":"test","pt":"msg","to":"{\"dimension\":{\"OMRÅDE\":{\"label\":\"område\",\"category\":{\"index\":{\"730\":0},\"label\":{\"730\":\"Randers\"}}},\"DRIV\":{\"label\":\"drivmiddel\",\"category\":{\"index\":{\"20225\":0},\"label\":{\"20225\":\"El\"}}},\"ContentsCode\":{\"label\":\"Indhold\",\"category\":{\"index\":{\"BIL54\":0},\"label\":{\"BIL54\":\"Bestand af motorkøretøjer\"},\"unit\":{\"BIL54\":{\"base\":\"Antal\",\"decimals\":0}}}},\"Tid\":{\"label\":\"tid\",\"category\":{\"index\":{\"2018M01\":0,\"2018M02\":1,\"2018M03\":2,\"2018M04\":3,\"2018M05\":4,\"2018M06\":5,\"2018M07\":6,\"2018M08\":7,\"2018M09\":8,\"2018M10\":9,\"2018M11\":10,\"2018M12\":11},\"label\":{\"2018M01\":\"2018M01\",\"2018M02\":\"2018M02\",\"2018M03\":\"2018M03\",\"2018M04\":\"2018M04\",\"2018M05\":\"2018M05\",\"2018M06\":\"2018M06\",\"2018M07\":\"2018M07\",\"2018M08\":\"2018M08\",\"2018M09\":\"2018M09\",\"2018M10\":\"2018M10\",\"2018M11\":\"2018M11\",\"2018M12\":\"2018M12\"}}},\"id\":[\"OMRÅDE\",\"DRIV\",\"ContentsCode\",\"Tid\"],\"size\":[1,1,1,12],\"role\":{\"geo\":[\"OMRÅDE\"],\"metric\":[\"ContentsCode\"],\"time\":[\"Tid\"]}},\"label\":\"Bestand af motorkøretøjer efter område, drivmiddel, Indhold og tid\",\"source\":\"Danmarks Statistik\",\"updated\":\"2023-01-12T07:00:00Z\",\"value\":[97,98,98,100,97,98,101,104,107,103,103,110],\"extension\":{\"px\":{\"infofile\":\"https://www.dst.dk/statistikdokumentation/6345462f-02d1-4b4d-b241-1123b4aa0379\",\"tableid\":\"BIL54\",\"decimals\":0}}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":832,"y":138,"wires":[["48130d7525318156"]]},{"id":"7b7bda592abc184a","type":"template","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"hardcoded request","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n   \"table\": \"BIL54\",\n   \"format\": \"CSV\",\n   \"valuePresentation\": \"CodeAndValue\",\n   \"variables\": [\n      {\n         \"code\": \"OMRÅDE\",\n         \"values\": [\n            \"730\"\n         ]\n      },\n      {\n         \"code\": \"BILTYPE\",\n         \"values\": [\n            \"4000100001\"\n         ]\n      },\n      {\n         \"code\": \"BRUG\",\n         \"values\": [\n            \"1000\"\n         ]\n      },\n      {\n         \"code\": \"DRIV\",\n         \"values\": [\n            \"20200\",\n            \"20225\"\n         ]\n      },\n      {\n         \"code\": \"Tid\",\n         \"values\": [\n            \"2018M01\",\n            \"2018M02\",\n            \"2018M03\",\n            \"2018M04\",\n            \"2018M05\",\n            \"2018M06\",\n            \"2018M07\",\n            \"2018M08\",\n            \"2018M09\",\n            \"2018M10\",\n            \"2018M11\",\n            \"2018M12\",\n            \"2019M01\",\n            \"2019M02\",\n            \"2019M03\",\n            \"2019M04\",\n            \"2019M05\",\n            \"2019M06\",\n            \"2019M07\",\n            \"2019M08\",\n            \"2019M09\",\n            \"2019M10\",\n            \"2019M11\",\n            \"2019M12\"\n         ]\n      }\n   ]\n}","output":"str","x":492,"y":138,"wires":[[]]},{"id":"a1cf2a2c01ec00f5","type":"debug","z":"fab488d10bc34cea","name":"debug 5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":960,"y":389,"wires":[]},{"id":"591118e9649d8bb1","type":"MySQL-Connector","z":"fab488d10bc34cea","g":"e2663cd400512ad4","server":"8dd94efcd0784de3","name":"Forbind til database og udfør query","x":613,"y":391,"wires":[["a1cf2a2c01ec00f5"]]},{"id":"59254d4ebaf981fa","type":"sql-prepare","z":"fab488d10bc34cea","g":"e2663cd400512ad4","name":"Sammensæt query","x":363,"y":391,"wires":[["591118e9649d8bb1"]]},{"id":"f3ca62a5e2a10d1e","type":"change","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Rens og oversæt datofelt til iso8601","rules":[{"t":"set","p":"dato","pt":"msg","to":"$map(payload.TID, function($v, $i, $a) {    $replace($substring($v,8),\"M\",\"-\") & \"-01\" })","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":280,"wires":[["6dc1600ef156a1e0"]]},{"id":"f8f237e2d239c7b5","type":"split","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":970,"y":240,"wires":[["f3ca62a5e2a10d1e"]]},{"id":"4e1817195ba88e18","type":"change","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Opsætning af kolonner","rules":[{"t":"set","p":"column_name","pt":"msg","to":"[\"dato_iso8601\", \"Drivmiddel\", \"Antal\"]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":240,"wires":[["f8f237e2d239c7b5"]]},{"id":"6dc1600ef156a1e0","type":"change","z":"fab488d10bc34cea","g":"a4ffe43b4506127a","name":"Indsæt dato, drivmiddel og antal","rules":[{"t":"set","p":"column_sort","pt":"msg","to":"[ dato, payload.DRIV, payload.INDHOLD]","tot":"jsonata"},{"t":"delete","p":"dato","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":280,"wires":[["f17bc4dde7e00d72"]]},{"id":"f62200177295c9cd","type":"csv","z":"fab488d10bc34cea","d":true,"g":"a4ffe43b4506127a","name":"Konverter data fra semikolon separeret format","sep":";","hdrin":true,"hdrout":"none","multi":"mult","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":460,"y":240,"wires":[[]]},{"id":"cd3f8d13b171e665","type":"change","z":"fab488d10bc34cea","g":"56d6546b49429320","name":"Opsætning af forespørgsel \\n Antal indregistrerede biler i Randers Kommune \\n Antal biler med drivmiddel \"El\" indregistreret i Randers Kommune","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.statbank.dk/v1/data","tot":"str"},{"t":"set","p":"method","pt":"msg","to":"POST","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"table\":\"BIL54\",\"format\":\"CSV\",\"valuePresentation\":\"CodeAndValue\",\"variables\":[{\"code\":\"OMRÅDE\",\"values\":[\"730\"]},{\"code\":\"BILTYPE\",\"values\":[\"4000100001\"]},{\"code\":\"BRUG\",\"values\":[\"1000\"]},{\"code\":\"DRIV\",\"values\":[\"20200\",\"20225\"]},{\"code\":\"Tid\",\"values\":[\"*\"]}]}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":502,"y":118,"wires":[[]]}]